void 0===Craft.Smith&&(Craft.Smith={}),function(t){Craft.Smith.Init=Garnish.Base.extend({init:function(a){for(var e=Garnish.$doc.find(".matrix-field"),i=0;i<e.length;i++)for(var n=t(e[i]),s=n.find("> .blocks > .matrixblock"),o=0;o<s.length;o++){var c=t(s[o]),r,l=c.find(".actions .settings.menubtn").data("menubtn")||!1;if(!l)return;new Craft.Smith.Menu(n,c,l)}Garnish.on(Craft.MatrixInput,"blockAdded",t.proxy(this,"blockAdded"))},blockAdded:function(a){Garnish.requestAnimationFrame(t.proxy(function(){var e=a.target.$container,i=t(a.$block),n,s=i.find(".actions .settings.menubtn").data("menubtn")||!1;s?new Craft.Smith.Menu(e,i,s):this.blockAdded(a)},this))}}),Craft.Smith.Menu=Garnish.Base.extend({init:function(a,e,i){this.$matrixField=a,this.$matrixBlock=e,this.menuBtn=i,this.menu=i.menu;var n=this.menu.$container.find('a[data-action="delete"]').parents("li");this.$copyBtn=t('<a data-icon="copy" data-action="copy">'+Craft.t("app","Copy")+"</a>"),this.$pasteBtn=t('<a data-icon="paste" data-action="paste">'+Craft.t("app","Paste")+"</a>"),this.$cloneBtn=t('<a data-icon="clone" data-action="clone">'+Craft.t("app","Clone")+"</a>"),this.$copyBtn.insertBefore(n).wrap("<li/>"),this.$pasteBtn.insertBefore(n).wrap("<li/>"),this.$cloneBtn.insertBefore(n).wrap("<li/>"),t('<hr class="padded">').insertBefore(n),this.menu.addOptions(this.$copyBtn),this.menu.addOptions(this.$pasteBtn),this.menu.addOptions(this.$cloneBtn),this.menu.on("optionselect",t.proxy(this,"onOptionSelect")),this.checkPaste()},onOptionSelect:function(a){var e=t(a.selectedOption);e.hasClass("disabled")||e.hasClass("sel")||("copy"==e.data("action")&&this.copyBlock(a),"paste"==e.data("action")&&this.pasteBlock(a),"clone"==e.data("action")&&this.cloneBlock(a))},checkPaste:function(){var t=!1;try{var a=JSON.parse(localStorage.getItem("smith:block")),e=this.$matrixField.attr("id").replace("fields-","");a&&a.field==e&&(t=!0)}catch(t){}t?this.$pasteBtn.enable():this.$pasteBtn.disable()},copyBlock:function(t){var a=this._serializeBlocks();localStorage.setItem("smith:block",JSON.stringify(a));var e=a.blocks.length,i=1==e?"1 block copied":"{n} blocks copied";Craft.cp.displayNotice(Craft.t("app",i,{n:e})),this.checkPaste()},pasteBlock:function(a,e){try{if(!e)var e=JSON.parse(localStorage.getItem("smith:block"));var i=this.$matrixField.find(".blocks"),n=t('<div class="spinner smith-spinner"></div>').appendTo(i),s=this.$matrixField.data("matrix");Craft.postActionRequest("smith/field/render-matrix-blocks",e,t.proxy(function(t,a){if("success"===a&&t.success)for(var e=0;e<t.blocks.length;e++){var i=t.blocks[e],o=s.blockTypesByHandle[i.typeHandle];s.blockTypesByHandle[i.typeHandle]=i;var c=s.addBlock(i.typeHandle);s.blockTypesByHandle[i.typeHandle]=o}n.remove()}))}catch(a){}},cloneBlock:function(t){var a=this._serializeBlocks();this.pasteBlock(t,a)},_serializeBlocks:function(){var t={field:"",blocks:[]},a,e=this.$matrixField.data("matrix").blockSelect.$selectedItems;e.length||(e=[this.$matrixBlock]);for(var i=0;i<e.length;i++){var n=e[i],s=Garnish.getPostData(n),o=Craft.expandPostArray(s);for(var c in o.fields)for(var r in t.field=c,o.fields[c]){var l=o.fields[c][r];t.blocks.push(l)}}return t}})}(jQuery);
//# sourceMappingURL=smith.js.map