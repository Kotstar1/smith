void 0===Craft.Smith&&(Craft.Smith={}),function(t){Craft.Smith.Init=Garnish.Base.extend({init:function(a){Garnish.requestAnimationFrame(t.proxy((function(){for(var a=Garnish.$doc.find(".matrix-field"),e=0;e<a.length;e++)for(var i=t(a[e]),n=i.find("> .blocks > .matrixblock"),s=0;s<n.length;s++){var r=t(n[s]),o,c=r.find(".actions .settings.menubtn").data("menubtn")||!1;if(!c)return;new Craft.Smith.Menu(i,r,n,c)}Garnish.on(Craft.MatrixInput,"blockAdded",t.proxy(this,"blockAdded")),Craft.SuperTable&&Craft.SuperTable.MatrixInputAlt&&Garnish.on(Craft.SuperTable.MatrixInputAlt,"blockAdded",t.proxy(this,"blockAdded"))}),this))},blockAdded:function(a){Garnish.requestAnimationFrame(t.proxy((function(){var e=a.target.$container,i=e.find("> .blocks > .matrixblock"),n=t(a.$block),s,r=n.find(".actions .settings.menubtn").data("menubtn")||!1;r?new Craft.Smith.Menu(e,n,i,r):this.blockAdded(a)}),this))}}),Craft.Smith.Menu=Garnish.Base.extend({init:function(a,e,i,n){this.$matrixField=a,this.$matrixBlock=e,this.$matrixBlocks=i,this.menuBtn=n,this.menu=n.menu;var s=this.menu.$container.find('a[data-action="delete"]').parents("li");this.$copyBtn=t('<a data-icon="copy" data-action="copy">'+Craft.t("app","Copy")+"</a>"),this.$pasteBtn=t('<a data-icon="paste" data-action="paste">'+Craft.t("app","Paste")+"</a>"),this.$cloneBtn=t('<a data-icon="clone" data-action="clone">'+Craft.t("app","Clone")+"</a>"),this.$copyBtn.insertBefore(s).wrap("<li/>"),this.$pasteBtn.insertBefore(s).wrap("<li/>"),this.$cloneBtn.insertBefore(s).wrap("<li/>"),t('<hr class="padded">').insertBefore(s),this.menu.addOptions(this.$copyBtn),this.menu.addOptions(this.$pasteBtn),this.menu.addOptions(this.$cloneBtn),this.menu.on("optionselect",t.proxy(this,"onOptionSelect")),this.checkPaste()},onOptionSelect:function(a){var e=t(a.selectedOption);e.hasClass("disabled")||e.hasClass("sel")||("copy"==e.data("action")&&this.copyBlock(a),"paste"==e.data("action")&&this.pasteBlock(a),"clone"==e.data("action")&&this.cloneBlock(a))},checkPaste:function(){var t=!1;try{var a=JSON.parse(localStorage.getItem("smith:block")),e=this.$matrixField.attr("id").replace("fields-","");a&&a.field==e&&(t=!0)}catch(t){}t?this.$pasteBtn.enable():this.$pasteBtn.disable()},copyBlock:function(t){var a=this._serializeBlocks();localStorage.setItem("smith:block",JSON.stringify(a));var e=a.blocks.length,i=1==e?"1 block copied":"{n} blocks copied";Craft.cp.displayNotice(Craft.t("app",i,{n:e})),this.checkPaste()},pasteBlock:function(a,e){try{if(!e)var e=JSON.parse(localStorage.getItem("smith:block"));var i=this.$matrixField.find(".blocks"),n=t('<div class="spinner smith-spinner"></div>').insertAfter(this.$matrixBlock),s=this.$matrixField.data("matrix"),r=null;this.$matrixBlocks.each(t.proxy((function(a,e){if(this.$matrixBlock.data("id")==t(e).data("id")){var i=this.$matrixBlocks[a+1];if(i)return r=t(i)}}),this)),Craft.postActionRequest("smith/field/render-matrix-blocks",e,t.proxy((function(t,a){if("success"===a&&t.success)for(var e=0;e<t.blocks.length;e++){var i=t.blocks[e],o=s.blockTypesByHandle[i.typeHandle];s.blockTypesByHandle[i.typeHandle]=i;var c=s.addBlock(i.typeHandle,r);s.blockTypesByHandle[i.typeHandle]=o}n.remove()}),this))}catch(a){}},cloneBlock:function(t){var a=this._serializeBlocks();this.pasteBlock(t,a)},_serializeBlocks:function(){var t={field:"",namespace:"",blocks:[]},a,e=this.$matrixField.data("matrix").blockSelect.$selectedItems;e.length||(e=[this.$matrixBlock]);for(var i=0;i<e.length;i++){var n=e[i],s=Garnish.getPostData(n),r,o;if(n.parents(".field").length>1){var c={};for(var l in s){var d=l.replace(/^fields.+?(?<=fields])/gm,"fields");t.namespace=l.match(/^fields.+?(?<=fields])/gm)[0],c[d]=s[l]}var h=Craft.expandPostArray(c)}else var h=Craft.expandPostArray(s);var p=h.fields;for(var f in p)for(var m in t.field=f,p[f].blocks){var k=p[f].blocks[m];t.blocks.push(k)}}return t}})}(jQuery);
//# sourceMappingURL=smith.js.map